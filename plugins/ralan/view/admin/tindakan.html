<ul class="nav nav-tabs" role="tablist">
    <li role="presentation" class="active"><a href="#dokter" aria-controls="dokter" role="tab" data-toggle="tab">Dokter</a></li>
    <li role="presentation"><a href="#perawat" aria-controls="perawat" role="tab" data-toggle="tab">Perawat</a></li>
    <li role="presentation"><a href="#dokter_perawat" aria-controls="dokter_perawat" role="tab" data-toggle="tab">Dokter & Perawat</a></li>
</ul>

<div class="panel-default">
    <div class="panel-body">
        <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade in active" id="dokter">
                <form name="kasir" action="{?=url(ADMIN.'/kasir/tindakansave/'.@$kasir.no_rawat)?}#dokter" method="POST">
                <div class="row clearfix" id="item_resep">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label>Nama Dokter</label>
                            <select name="kd_dokter" class="form-control dokter" data-keep-open="true" data-use-dimmer="false" data-options-height="126px">
                            </select>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group">
                            <label>Nama Tindakan</label>
                            <select name="kd_jenis_prw[]" class="form-control jns_perawatan" multiple data-keep-open="true" data-use-dimmer="false" data-options-height="126px">
                                {loop: $ralan.rawat_dr}
                                <option value="{$value.kd_jenis_prw}" selected>{$value.nm_perawatan}</option>
                                {/loop}
                            </select>
                        </div>
                    </div>
                </div>
                <input type="submit" name="save" value="Simpan" class="btn btn-primary" />
                </form>
            </div>
            <div role="tabpanel" class="tab-pane fade in" id="perawat">
                <form name="ralan" action="{?=url(ADMIN.'/kasir/tindakansave/'.@$kasir.no_rawat)?}#perawat" method="POST">
                <div class="row clearfix" id="item_resep">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label>Nama Perawat</label>
                            <select name="kd_dokter" class="form-control dokter" data-keep-open="true" data-use-dimmer="false" data-options-height="126px">
                            </select>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group">
                            <label>Nama Tindakan</label>
                            <select name="kd_jenis_prw[]" class="form-control jns_perawatan" multiple data-keep-open="true" data-use-dimmer="false" data-options-height="126px">
                                {loop: $ralan.rawat_dr}
                                <option value="{$value.kd_jenis_prw}" selected>{$value.nm_perawatan}</option>
                                {/loop}
                            </select>
                        </div>
                    </div>
                </div>
                <input type="submit" name="save" value="Simpan" class="btn btn-primary" />
                </form>
            </div>
            <div role="tabpanel" class="tab-pane fade in" id="dokter_perawat">
                <form name="ralan" action="{?=url(ADMIN.'/kasir/tindakansave/'.@$kasir.no_rawat)?}#dokter_perawat" method="POST">
                <div class="row clearfix" id="item_resep">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Nama Dokter</label>
                            <select name="kd_dokter" class="form-control dokter" data-keep-open="true" data-use-dimmer="false" data-options-height="126px">
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Nama Perawat</label>
                            <select name="kd_dokter" class="form-control dokter" data-keep-open="true" data-use-dimmer="false" data-options-height="126px">
                            </select>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group">
                            <label>Nama Tindakan</label>
                            <select name="kd_jenis_prw[]" class="form-control jns_perawatan" multiple data-keep-open="true" data-use-dimmer="false" data-options-height="126px">
                                {loop: $ralan.rawat_dr}
                                <option value="{$value.kd_jenis_prw}" selected>{$value.nm_perawatan}</option>
                                {/loop}
                            </select>
                        </div>
                    </div>
                </div>
                <input type="submit" name="save" value="Simpan" class="btn btn-primary" />
                </form>
            </div>

        </div>
    </div>
</div>

<script>
  $(document).ready(function() {
      $('select').selectator();
      $(document).on('click', '.add_tindakan', function(){
          var html = '';
          html += '<div class="clearfix row_resep">';
          html += '   <div class="col-md-5">';
          html += '       <div class="form-group">';
          html += '            <label class="visible-xs">Nama Obat</label>';
          html += '            <select name="kode_brng[]" class="form-control databarang_ajax">';
          html += '            </select>';
          html += '        </div>';
          html += '    </div>';
          html += '    <div class="col-md-2">';
          html += '        <div class="form-group">';
          html += '            <label class="visible-xs">Jumlah</label>';
          html += '            <input type="text" name="jml[]" class="form-control" />';
          html += '        </div>';
          html += '    </div>';
          html += '    <div class="col-md-4">';
          html += '        <div class="form-group">';
          html += '            <label class="visible-xs">Aturan Pakai</label>';
          html += '            <select name="aturan_pakai[]" class="form-control master_aturan_pakai">';
          html += '            </select>';
          html += '        </div>';
          html += '    </div>';
          html += '    <div class="col-md-1">';
          html += '      <div class="form-group">';
          html += '            <label>&nbsp;</label>';
          html += '            <button class="btn btn-danger remove">-</button>';
          html += '        </div>';
          html += '    </div>';
          html += '</div>';
          $('#item_resep').append(html);
          var strip_tags = function(str) {
            return (str + '').replace(/<\/?[^>]+(>|$)/g, '')
          };
          var truncate_string = function(str, chars) {
            if ($.trim(str).length <= chars) {
              return str;
            } else {
              return $.trim(str.substr(0, chars)) + 'â€¦';
            }
          };
          $('.databarang_ajax').selectator({
            labels: {
              search: 'Cari obat...'
            },
            load: function (search, callback) {
              if (search.length < this.minSearchLength) return callback();
              $.ajax({
                url: '{?=url()?}/admin/kasir/ajax?show=databarang&nama_brng=' + encodeURIComponent(search) + '&t={?=$_SESSION['token']?}',
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                  callback(data.slice(0, 100));
                  console.log(data);
                },
                error: function() {
                  callback();
                }
              });
            },
            delay: 300,
            minSearchLength: 1,
            valueField: 'kode_brng',
            textField: 'nama_brng'
          });
          $('.master_aturan_pakai').selectator({
            labels: {
              search: 'Cari aturan pakai...'
            },
            load: function (search, callback) {
              if (search.length < this.minSearchLength) return callback();
              $.ajax({
                url: '{?=url()?}/admin/kasir/ajax?show=aturan_pakai&aturan=' + encodeURIComponent(search) + '&t={?=$_SESSION['token']?}',
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                  callback(data.slice(0, 100));
                  console.log(data);
                },
                error: function() {
                  callback();
                }
              });
            },
            delay: 300,
            minSearchLength: 1,
            valueField: 'aturan',
            textField: 'aturan'
          });
          $('select').each(function () {
              var options = {
                  useDimmer: true,
                  useSearch: true,
                  labels: {
                      search: '...'
                  }
              };
              $.each($(this).data(), function (key, value) {
                  options[key] = value;
              });
              $(this).selectator(options);
          });
      });

      $(document).on('click', '.remove', function(){
          $(this).closest('.row_resep').remove();
      });

  });
</script>
